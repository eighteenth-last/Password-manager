import{U as a,V as r}from"./index-3d7d46f8.js";const d=a("bindings",{state:()=>({bindings:[],pendingRequests:[],loading:!1,error:null}),getters:{getBindingById:s=>n=>s.bindings.find(t=>t.id===n),getRequestById:s=>n=>s.pendingRequests.find(t=>t.id===n),hasBindings:s=>s.bindings.length>0,hasPendingRequests:s=>s.pendingRequests.length>0},actions:{async fetchBindings(){var s,n;this.loading=!0,this.error=null;try{const t=await r.get("/api/accounts/bindings");return this.bindings=t.data.bindings||[],this.pendingRequests=t.data.pendingRequests||[],{bindings:this.bindings,pendingRequests:this.pendingRequests}}catch(t){throw console.error("获取绑定关系失败:",t),this.error=((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.message)||"获取绑定关系失败",t}finally{this.loading=!1}},async bindAccount(s){var n,t;this.loading=!0,this.error=null;try{return(await r.post("/api/accounts/bind",{targetEmail:s})).data}catch(e){throw console.error("发送绑定请求失败:",e),this.error=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"发送绑定请求失败",e}finally{this.loading=!1}},async acceptBindingRequest(s){var n,t;this.loading=!0,this.error=null;try{await r.post(`/api/accounts/bindings/${s}/accept`);const e=this.getRequestById(s);return e&&(this.pendingRequests=this.pendingRequests.filter(i=>i.id!==s),this.bindings.push({...e,binding_status:"active"})),!0}catch(e){throw console.error("接受绑定请求失败:",e),this.error=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"接受绑定请求失败",e}finally{this.loading=!1}},async rejectBindingRequest(s){var n,t;this.loading=!0,this.error=null;try{return await r.post(`/api/accounts/bindings/${s}/reject`),this.pendingRequests=this.pendingRequests.filter(e=>e.id!==s),!0}catch(e){throw console.error("拒绝绑定请求失败:",e),this.error=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"拒绝绑定请求失败",e}finally{this.loading=!1}},async unbindAccount(s){var n,t;this.loading=!0,this.error=null;try{return await r.delete(`/api/accounts/bindings/${s}`),this.bindings=this.bindings.filter(e=>e.id!==s),!0}catch(e){throw console.error("解除绑定失败:",e),this.error=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"解除绑定失败",e}finally{this.loading=!1}},async updateBindingPermissions(s,n){var t,e;this.loading=!0,this.error=null;try{await r.put(`/api/accounts/bindings/${s}/permissions`,{permissions:n});const i=this.getBindingById(s);return i&&(i.permissions=n),!0}catch(i){throw console.error("更新绑定权限失败:",i),this.error=((e=(t=i.response)==null?void 0:t.data)==null?void 0:e.message)||"更新绑定权限失败",i}finally{this.loading=!1}}}});export{d as u};
