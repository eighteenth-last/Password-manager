import{b as Y,r as v,j as w,k as ee,F as se,E as d,d as c,o as te,e as le,f as o,g as s,w as l,t as V,i as f,n as oe,l as ae,v as F}from"./index-3d7d46f8.js";import{u as re}from"./bindings-ef4849e6.js";import{u as ne}from"./passwords-fd45e788.js";import{_ as ue}from"./_plugin-vue_export-helper-c27b6911.js";const ie={class:"settings-view"},de={class:"account-info"},ce={class:"info-item"},me={class:"info-value"},fe={class:"info-item"},pe={class:"info-value"},ve={class:"info-item"},ge={class:"info-value"},we={class:"account-actions"},ye={class:"danger-warning"},_e={class:"danger-actions"},be={class:"password-strength"},Se={class:"strength-meter"},Pe={class:"strength-text"},Ve={class:"password-warning"},ke={__name:"SettingsView",setup(he){const b=Y(),k=re(),T=ne(),h=v(!1),C=v(!1),y=v(!1),O=w(()=>b.userEmail||"未知"),D=w(()=>{var t;return((t=b.user)==null?void 0:t.id)||"未知"}),B=w(()=>k.bindings.length||0),g=v({autoLockTimeout:15,lockOnClose:!0}),p=v({autoSync:!0,syncInterval:15}),u=v({currentPassword:"",newPassword:"",confirmPassword:""}),N={currentPassword:[{required:!0,message:"请输入当前主密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新主密码",trigger:"blur"},{min:8,message:"密码长度至少为8个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新主密码",trigger:"blur"},{validator:(t,e,r)=>{e!==u.value.newPassword?r(new Error("两次输入的密码不一致")):r()},trigger:"blur"}]},U=v(null),M=v(null),S=v(null),P=w(()=>{const t=u.value.newPassword;if(!t)return 0;let e=0;t.length>=8&&e++,t.length>=12&&e++;const r=/[a-z]/.test(t),m=/[A-Z]/.test(t),a=/\d/.test(t),_=/[^a-zA-Z0-9]/.test(t);return(r&&m||a&&_)&&e++,r&&m&&a&&_&&e++,Math.min(3,e)}),R=w(()=>{const t=P.value;return t===0?"weak":t===1?"medium":t===2?"strong":"very-strong"}),J=w(()=>`${(P.value+1)*25}%`),$=w(()=>{const t=P.value;return t===0?"弱":t===1?"中":t===2?"强":"非常强"});ee(()=>u.value.newPassword,()=>{var t;u.value.confirmPassword&&((t=S.value)==null||t.validateField("confirmPassword"))}),se(async()=>{try{await k.fetchBindings(),z()}catch(t){console.error("加载数据失败:",t),d.error("加载数据失败，请稍后重试")}});const z=async()=>{var t,e,r,m;try{const a=JSON.parse(localStorage.getItem("settings")||"{}");g.value={autoLockTimeout:((t=a.security)==null?void 0:t.autoLockTimeout)||15,lockOnClose:((e=a.security)==null?void 0:e.lockOnClose)!==!1},p.value={autoSync:((r=a.sync)==null?void 0:r.autoSync)!==!1,syncInterval:((m=a.sync)==null?void 0:m.syncInterval)||15}}catch(a){console.error("加载设置失败:",a)}},A=async()=>{try{const t=JSON.parse(localStorage.getItem("settings")||"{}");t.security={autoLockTimeout:g.value.autoLockTimeout,lockOnClose:g.value.lockOnClose},localStorage.setItem("settings",JSON.stringify(t)),d.success("安全设置已保存")}catch(t){console.error("保存设置失败:",t),d.error("保存设置失败，请稍后重试")}},q=async()=>{try{const t=JSON.parse(localStorage.getItem("settings")||"{}");t.sync={autoSync:p.value.autoSync,syncInterval:p.value.syncInterval},localStorage.setItem("settings",JSON.stringify(t)),d.success("同步设置已保存")}catch(t){console.error("保存设置失败:",t),d.error("保存设置失败，请稍后重试")}},Z=async()=>{h.value=!0;try{await T.syncPasswords(),d.success("同步成功")}catch(t){console.error("同步失败:",t),d.error("同步失败，请稍后重试")}finally{h.value=!1}},j=()=>{u.value={currentPassword:"",newPassword:"",confirmPassword:""},y.value=!0},W=async()=>{if(S.value)try{if(await S.value.validate(),P.value<2){d.warning("请设置更强的密码");return}C.value=!0,await new Promise(t=>setTimeout(t,1e3)),y.value=!1,d.success("主密码已修改")}catch(t){console.error("修改主密码失败:",t),d.error("修改主密码失败，请稍后重试")}finally{C.value=!1}},G=()=>{F.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{b.logout()}).catch(()=>{})},H=()=>{F.prompt('此操作将永久删除您的所有数据，无法恢复。请输入"DELETE"以确认。',"危险操作",{confirmButtonText:"清除数据",cancelButtonText:"取消",inputPattern:/^DELETE$/,inputErrorMessage:'请输入"DELETE"以确认',type:"error"}).then(({value:t})=>{t==="DELETE"&&K()}).catch(()=>{})},K=async()=>{try{localStorage.clear(),T.$reset(),k.$reset(),b.logout(),d.success("所有数据已清除")}catch(t){console.error("清除数据失败:",t),d.error("清除数据失败，请稍后重试")}};return(t,e)=>{const r=c("el-button"),m=c("el-card"),a=c("el-option"),_=c("el-select"),i=c("el-form-item"),I=c("el-checkbox"),Q=c("el-divider"),x=c("el-form"),L=c("el-alert"),E=c("el-input"),X=c("el-dialog");return te(),le("div",ie,[e[26]||(e[26]=o("h1",{class:"page-title"},"系统设置",-1)),s(m,{class:"settings-card"},{header:l(()=>[...e[9]||(e[9]=[o("div",{class:"card-header"},[o("span",null,"账号信息")],-1)])]),default:l(()=>[o("div",de,[o("div",ce,[e[10]||(e[10]=o("span",{class:"info-label"},"邮箱:",-1)),o("span",me,V(O.value),1)]),o("div",fe,[e[11]||(e[11]=o("span",{class:"info-label"},"账号ID:",-1)),o("span",pe,V(D.value),1)]),o("div",ve,[e[12]||(e[12]=o("span",{class:"info-label"},"绑定账号数:",-1)),o("span",ge,V(B.value),1)])]),o("div",we,[s(r,{type:"danger",onClick:G},{default:l(()=>[...e[13]||(e[13]=[f("退出登录",-1)])]),_:1})])]),_:1}),s(m,{class:"settings-card"},{header:l(()=>[...e[14]||(e[14]=[o("div",{class:"card-header"},[o("span",null,"安全设置")],-1)])]),default:l(()=>[s(x,{ref_key:"securityFormRef",ref:U,model:g.value,"label-width":"140px"},{default:l(()=>[s(i,{label:"自动锁定时间"},{default:l(()=>[s(_,{modelValue:g.value.autoLockTimeout,"onUpdate:modelValue":e[0]||(e[0]=n=>g.value.autoLockTimeout=n),style:{width:"200px"}},{default:l(()=>[s(a,{label:"1分钟",value:1}),s(a,{label:"5分钟",value:5}),s(a,{label:"15分钟",value:15}),s(a,{label:"30分钟",value:30}),s(a,{label:"1小时",value:60}),s(a,{label:"从不",value:0})]),_:1},8,["modelValue"])]),_:1}),s(i,null,{default:l(()=>[s(I,{modelValue:g.value.lockOnClose,"onUpdate:modelValue":e[1]||(e[1]=n=>g.value.lockOnClose=n)},{default:l(()=>[...e[15]||(e[15]=[f("关闭浏览器时锁定",-1)])]),_:1},8,["modelValue"])]),_:1}),s(Q),s(i,{label:"修改主密码"},{default:l(()=>[s(r,{type:"primary",onClick:j},{default:l(()=>[...e[16]||(e[16]=[f("修改主密码",-1)])]),_:1})]),_:1}),s(i,null,{default:l(()=>[s(r,{type:"primary",onClick:A},{default:l(()=>[...e[17]||(e[17]=[f("保存设置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),s(m,{class:"settings-card"},{header:l(()=>[...e[18]||(e[18]=[o("div",{class:"card-header"},[o("span",null,"同步设置")],-1)])]),default:l(()=>[s(x,{ref_key:"syncFormRef",ref:M,model:p.value,"label-width":"140px"},{default:l(()=>[s(i,null,{default:l(()=>[s(I,{modelValue:p.value.autoSync,"onUpdate:modelValue":e[2]||(e[2]=n=>p.value.autoSync=n)},{default:l(()=>[...e[19]||(e[19]=[f("启用自动同步",-1)])]),_:1},8,["modelValue"])]),_:1}),s(i,{label:"同步间隔"},{default:l(()=>[s(_,{modelValue:p.value.syncInterval,"onUpdate:modelValue":e[3]||(e[3]=n=>p.value.syncInterval=n),style:{width:"200px"},disabled:!p.value.autoSync},{default:l(()=>[s(a,{label:"5分钟",value:5}),s(a,{label:"15分钟",value:15}),s(a,{label:"30分钟",value:30}),s(a,{label:"1小时",value:60}),s(a,{label:"6小时",value:360}),s(a,{label:"12小时",value:720})]),_:1},8,["modelValue","disabled"])]),_:1}),s(i,null,{default:l(()=>[s(r,{type:"primary",onClick:q},{default:l(()=>[...e[20]||(e[20]=[f("保存设置",-1)])]),_:1}),s(r,{type:"success",onClick:Z,loading:h.value},{default:l(()=>[...e[21]||(e[21]=[f("立即同步",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),s(m,{class:"settings-card danger-card"},{header:l(()=>[...e[22]||(e[22]=[o("div",{class:"card-header"},[o("span",null,"危险区域")],-1)])]),default:l(()=>[o("div",ye,[s(L,{title:"警告：以下操作将永久删除您的数据，无法恢复",type:"error",closable:!1,"show-icon":""})]),o("div",_e,[s(r,{type:"danger",onClick:H},{default:l(()=>[...e[23]||(e[23]=[f("清除所有数据",-1)])]),_:1})])]),_:1}),s(X,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=n=>y.value=n),title:"修改主密码",width:"500px"},{default:l(()=>[s(x,{ref_key:"passwordFormRef",ref:S,model:u.value,rules:N,"label-width":"120px"},{default:l(()=>[s(i,{label:"当前主密码",prop:"currentPassword"},{default:l(()=>[s(E,{modelValue:u.value.currentPassword,"onUpdate:modelValue":e[4]||(e[4]=n=>u.value.currentPassword=n),type:"password",placeholder:"请输入当前主密码","show-password":""},null,8,["modelValue"])]),_:1}),s(i,{label:"新主密码",prop:"newPassword"},{default:l(()=>[s(E,{modelValue:u.value.newPassword,"onUpdate:modelValue":e[5]||(e[5]=n=>u.value.newPassword=n),type:"password",placeholder:"请输入新主密码","show-password":""},null,8,["modelValue"])]),_:1}),s(i,{label:"确认新主密码",prop:"confirmPassword"},{default:l(()=>[s(E,{modelValue:u.value.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=n=>u.value.confirmPassword=n),type:"password",placeholder:"请再次输入新主密码","show-password":""},null,8,["modelValue"])]),_:1}),s(i,{label:"密码强度"},{default:l(()=>[o("div",be,[o("div",Se,[o("div",{class:oe(["strength-bar",R.value]),style:ae({width:J.value})},null,6)]),o("div",Pe,V($.value),1)])]),_:1}),o("div",Ve,[s(L,{title:"重要提示：请记住您的主密码！如果忘记，您将无法恢复已保存的密码。",type:"warning",closable:!1,"show-icon":""})]),s(i,null,{default:l(()=>[s(r,{type:"primary",onClick:W,loading:C.value},{default:l(()=>[...e[24]||(e[24]=[f(" 修改主密码 ",-1)])]),_:1},8,["loading"]),s(r,{onClick:e[7]||(e[7]=n=>y.value=!1)},{default:l(()=>[...e[25]||(e[25]=[f("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Le=ue(ke,[["__scopeId","data-v-b3a046bf"]]);export{Le as default};
