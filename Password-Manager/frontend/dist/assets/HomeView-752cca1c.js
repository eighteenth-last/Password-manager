import{u as Q,r as w,j as k,F as W,E as v,d as c,G as X,o as n,e as m,f as e,g as s,w as t,m as _,t as d,n as Y,p as S,H as Z,I as ss,q as ts,i as p,J as as,K as es,L as os,M as ls,N as ns,O as ds,P as is,Q as rs,z as cs,A as us}from"./index-3d7d46f8.js";import{u as _s}from"./passwords-fd45e788.js";import{u as ps}from"./bindings-ef4849e6.js";import{_ as ms}from"./_plugin-vue_export-helper-c27b6911.js";const vs={class:"dashboard-home"},fs={class:"card-header"},ys={class:"card-content"},ws={class:"stat-item"},hs={class:"stat-value"},gs={class:"stat-item"},bs={class:"stat-value"},ks={class:"stat-item"},Ss={class:"stat-value"},Ps={class:"card-header"},Cs={class:"card-content"},xs={class:"sync-status"},Ds={class:"status-info"},Ts={class:"status-text"},zs={class:"status-time"},Bs={class:"card-header"},Vs={class:"card-content"},Ns={key:0},As={class:"binding-email"},Es={key:0,class:"binding-more"},Hs={key:1,class:"empty-bindings"},Ls={class:"quick-actions"},Ms={class:"card-header"},qs={class:"domain-cell"},Fs={class:"domain-icon"},Is={__name:"HomeView",setup(Rs){const h=Q(),i=_s(),H=ps(),g=w(!0),P=w(!1),b=w({totalPasswords:0,totalDomains:0,sharedPasswords:0}),C=w([]),f=w([]),L=k(()=>f.value.slice(0,3)),x=k(()=>!!i.lastSyncTime),M=k(()=>x.value?"已同步":"未同步"),q=k(()=>i.lastSyncTime?new Date(i.lastSyncTime).toLocaleString():"从未同步");W(async()=>{try{await B()}catch(o){console.error("加载数据失败:",o),v.error("加载数据失败，请稍后重试")}finally{g.value=!1}});const B=async()=>{await i.fetchPasswords(),await i.fetchSharedPasswords();const o=await H.fetchBindings();f.value=o.bindings,V(),N()},V=()=>{const o=new Set;i.passwords.forEach(a=>{o.add(a.domain)}),b.value={totalPasswords:i.passwords.length,totalDomains:o.size,sharedPasswords:i.sharedPasswords.length}},N=()=>{C.value=[...i.passwords].sort((o,a)=>new Date(a.updated_at)-new Date(o.updated_at)).slice(0,5)},F=async()=>{g.value=!0;try{await B(),v.success("数据已刷新")}catch(o){console.error("刷新数据失败:",o),v.error("刷新数据失败，请稍后重试")}finally{g.value=!1}},I=async()=>{P.value=!0;try{await i.syncPasswords(),V(),N(),v.success("同步成功")}catch(o){console.error("同步失败:",o),v.error("同步失败，请稍后重试")}finally{P.value=!1}},R=o=>{v.success(`已复制 ${o.domain} 的密码`)},U=()=>{h.push("/dashboard/passwords?action=add")},A=()=>{h.push("/dashboard/passwords")},D=()=>{h.push("/dashboard/bindings")},$=()=>{h.push("/dashboard/settings")};return(o,a)=>{const u=c("el-icon"),r=c("el-button"),y=c("el-card"),T=c("el-col"),j=c("el-avatar"),G=c("el-tag"),E=c("el-empty"),J=c("el-row"),z=c("el-table-column"),K=c("el-table"),O=X("loading");return n(),m("div",vs,[a[15]||(a[15]=e("h1",{class:"page-title"},"仪表盘",-1)),s(J,{gutter:20},{default:t(()=>[s(T,{span:8},{default:t(()=>[s(y,{class:"stat-card"},{header:t(()=>[e("div",fs,[a[0]||(a[0]=e("span",null,"密码统计",-1)),s(r,{type:"text",onClick:F},{default:t(()=>[s(u,null,{default:t(()=>[s(_(es))]),_:1})]),_:1})])]),default:t(()=>[e("div",ys,[e("div",ws,[e("div",hs,d(b.value.totalPasswords),1),a[1]||(a[1]=e("div",{class:"stat-label"},"总密码数",-1))]),e("div",gs,[e("div",bs,d(b.value.totalDomains),1),a[2]||(a[2]=e("div",{class:"stat-label"},"网站数",-1))]),e("div",ks,[e("div",Ss,d(b.value.sharedPasswords),1),a[3]||(a[3]=e("div",{class:"stat-label"},"共享密码",-1))])])]),_:1})]),_:1}),s(T,{span:8},{default:t(()=>[s(y,{class:"stat-card"},{header:t(()=>[e("div",Ps,[a[4]||(a[4]=e("span",null,"同步状态",-1)),s(r,{type:"text",onClick:I,loading:P.value},{default:t(()=>[s(u,null,{default:t(()=>[s(_(os))]),_:1})]),_:1},8,["loading"])])]),default:t(()=>[e("div",Cs,[e("div",xs,[e("div",{class:Y(["status-icon",{synced:x.value}])},[x.value?(n(),S(u,{key:0},{default:t(()=>[s(_(ls))]),_:1})):(n(),S(u,{key:1},{default:t(()=>[s(_(ns))]),_:1}))],2),e("div",Ds,[e("div",Ts,d(M.value),1),e("div",zs,d(q.value),1)])])])]),_:1})]),_:1}),s(T,{span:8},{default:t(()=>[s(y,{class:"stat-card"},{header:t(()=>[e("div",Bs,[a[5]||(a[5]=e("span",null,"账号绑定",-1)),s(r,{type:"text",onClick:D},{default:t(()=>[s(u,null,{default:t(()=>[s(_(ds))]),_:1})]),_:1})])]),default:t(()=>[e("div",Vs,[f.value.length>0?(n(),m("div",Ns,[(n(!0),m(Z,null,ss(L.value,l=>(n(),m("div",{class:"binding-item",key:l.id},[s(j,{size:"small",src:l.avatar},{default:t(()=>[p(d(l.bound_account_email.charAt(0).toUpperCase()),1)]),_:2},1032,["src"]),e("span",As,d(l.bound_account_email),1),s(G,{size:"small",type:l.permissions==="read"?"info":"warning"},{default:t(()=>[p(d(l.permissions==="read"?"只读":"读写"),1)]),_:2},1032,["type"])]))),128)),f.value.length>3?(n(),m("div",Es," 还有 "+d(f.value.length-3)+" 个绑定账号... ",1)):ts("",!0)])):(n(),m("div",Hs,[s(E,{description:"暂无绑定账号","image-size":60},{default:t(()=>[s(r,{type:"primary",size:"small",onClick:D},{default:t(()=>[...a[6]||(a[6]=[p(" 绑定账号 ",-1)])]),_:1})]),_:1})]))])]),_:1})]),_:1})]),_:1}),s(y,{class:"action-card"},{header:t(()=>[...a[7]||(a[7]=[e("div",{class:"card-header"},[e("span",null,"快捷操作")],-1)])]),default:t(()=>[e("div",Ls,[s(r,{type:"primary",onClick:U},{default:t(()=>[s(u,null,{default:t(()=>[s(_(is))]),_:1}),a[8]||(a[8]=p(" 添加密码 ",-1))]),_:1}),s(r,{type:"success",onClick:A},{default:t(()=>[s(u,null,{default:t(()=>[s(_(rs))]),_:1}),a[9]||(a[9]=p(" 管理密码 ",-1))]),_:1}),s(r,{type:"warning",onClick:D},{default:t(()=>[s(u,null,{default:t(()=>[s(_(cs))]),_:1}),a[10]||(a[10]=p(" 账号绑定 ",-1))]),_:1}),s(r,{type:"info",onClick:$},{default:t(()=>[s(u,null,{default:t(()=>[s(_(us))]),_:1}),a[11]||(a[11]=p(" 系统设置 ",-1))]),_:1})])]),_:1}),s(y,{class:"password-card"},{header:t(()=>[e("div",Ms,[a[13]||(a[13]=e("span",null,"最近密码",-1)),s(r,{type:"text",onClick:A},{default:t(()=>[...a[12]||(a[12]=[p(" 查看全部 ",-1)])]),_:1})])]),default:t(()=>[as((n(),m("div",null,[C.value.length>0?(n(),S(K,{key:0,data:C.value,style:{width:"100%"}},{default:t(()=>[s(z,{prop:"domain",label:"网站",width:"180"},{default:t(l=>[e("div",qs,[e("div",Fs,d(l.row.domain.charAt(0).toUpperCase()),1),e("span",null,d(l.row.domain),1)])]),_:1}),s(z,{prop:"username",label:"用户名"}),s(z,{label:"操作",width:"150"},{default:t(l=>[s(r,{size:"small",onClick:Us=>R(l.row),type:"primary",plain:""},{default:t(()=>[...a[14]||(a[14]=[p(" 复制密码 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(n(),S(E,{key:1,description:"暂无密码记录","image-size":100}))])),[[O,g.value]])]),_:1})])}}},Ks=ms(Is,[["__scopeId","data-v-9b11aea2"]]);export{Ks as default};
